<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decision Neuron Quest</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #1f2940;
            --text-primary: #e8e8e8;
            --text-secondary: #a0a0b0;
            --accent-green: #00ff88;
            --accent-red: #ff4466;
            --accent-orange: #ff8c00;
            --accent-blue: #00d4ff;
            --border: #2a3a5a;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        .app-container { max-width: 1400px; margin: 0 auto; padding: 16px; }
        header { text-align: center; padding: 20px; margin-bottom: 20px; }
        header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { color: var(--text-secondary); margin-top: 8px; }

        .tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        .tab-btn {
            padding: 12px 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .tab-btn:hover { border-color: var(--accent-blue); color: var(--text-primary); }
        .tab-btn.active { background: var(--accent-blue); color: var(--bg-primary); border-color: var(--accent-blue); font-weight: 600; }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .card { background: var(--bg-card); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border); }
        .card h3 { font-size: 1rem; color: var(--text-secondary); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px; }

        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }

        .slider-group { margin-bottom: 16px; }
        .slider-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.9rem; }
        .slider-header .emoji { margin-right: 6px; }
        .slider-header .value { font-family: 'SF Mono', Monaco, monospace; color: var(--accent-blue); }
        input[type="range"] { width: 100%; height: 8px; -webkit-appearance: none; background: var(--bg-secondary); border-radius: 4px; outline: none; cursor: pointer; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: var(--accent-blue); cursor: pointer; }
        .slider-group.positive input[type="range"]::-webkit-slider-thumb { background: var(--accent-green); }
        .slider-group.negative input[type="range"]::-webkit-slider-thumb { background: var(--accent-red); }

        .neuron-container { display: flex; flex-direction: column; align-items: center; padding: 30px; }
        .neuron {
            width: 180px; height: 180px; border-radius: 50%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 2.5rem; font-weight: 700; transition: all 0.3s ease;
            box-shadow: 0 0 40px currentColor; margin-bottom: 20px;
        }
        .neuron.go { background: radial-gradient(circle, #00ff8855, #00ff8811); color: var(--accent-green); border: 3px solid var(--accent-green); }
        .neuron.skip { background: radial-gradient(circle, #ff446655, #ff446611); color: var(--accent-red); border: 3px solid var(--accent-red); }
        .neuron .label { font-size: 0.9rem; font-weight: 400; margin-top: 8px; }
        .result-text { font-size: 1.3rem; text-align: center; padding: 16px; border-radius: 8px; background: var(--bg-secondary); }
        .celebration { animation: pulse 0.5s ease-in-out infinite alternate; }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.05); } }

        .math-display { background: var(--bg-secondary); padding: 16px; border-radius: 8px; font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem; overflow-x: auto; margin-top: 16px; }
        .math-display .equation { margin-bottom: 8px; }
        .math-display .highlight { color: var(--accent-orange); }

        .heatmap-container { position: relative; }
        #boundaryCanvas, #trainingCanvas { width: 100%; height: 400px; background: #000; border-radius: 8px; cursor: crosshair; display: block; }
        .axis-selector { display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; align-items: center; }
        .axis-selector label { color: var(--text-secondary); font-size: 0.85rem; }
        .axis-selector select { padding: 8px 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); margin-left: 8px; }

        .training-controls { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
        .btn { padding: 10px 18px; border: none; border-radius: 6px; font-size: 0.9rem; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--accent-blue); color: var(--bg-primary); }
        .btn-primary:hover { filter: brightness(1.1); }
        .btn-secondary { background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--accent-blue); }
        .btn-success { background: var(--accent-green); color: var(--bg-primary); }
        .btn-danger { background: var(--accent-red); color: white; }
        .btn.active { outline: 3px solid white; }

        .training-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 16px; }
        .stat-box { background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center; }
        .stat-box .value { font-size: 1.3rem; font-weight: 600; color: var(--accent-blue); }
        .stat-box .label { font-size: 0.75rem; color: var(--text-secondary); margin-top: 4px; }

        .activation-selector { display: flex; gap: 8px; margin-bottom: 20px; }
        .activation-btn { flex: 1; padding: 12px; background: var(--bg-secondary); border: 2px solid var(--border); border-radius: 8px; color: var(--text-primary); cursor: pointer; text-align: center; transition: all 0.2s; }
        .activation-btn:hover { border-color: var(--accent-blue); }
        .activation-btn.active { border-color: var(--accent-blue); background: var(--accent-blue); color: var(--bg-primary); }
        .activation-btn .name { font-weight: 600; margin-bottom: 4px; }
        .activation-btn .formula { font-size: 0.75rem; font-family: monospace; opacity: 0.8; }

        #activationChart, #sensitivityChart { width: 100%; height: 250px; background: var(--bg-secondary); border-radius: 8px; display: block; }

        .scenario-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; }
        .scenario-btn { padding: 20px 16px; background: var(--bg-secondary); border: 2px solid var(--border); border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.2s; color: var(--text-primary); }
        .scenario-btn:hover { border-color: var(--accent-orange); transform: translateY(-2px); }
        .scenario-btn.active { border-color: var(--accent-orange); background: rgba(255,140,0,0.1); }
        .scenario-btn .emoji { font-size: 2rem; margin-bottom: 8px; display: block; }
        .scenario-btn .name { font-weight: 500; }

        .chain-container { display: flex; align-items: center; justify-content: center; gap: 40px; padding: 30px; flex-wrap: wrap; }
        .chain-neuron { width: 120px; height: 120px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 700; transition: all 0.3s; }
        .chain-neuron.go { background: radial-gradient(circle, #00ff8855, #00ff8811); color: var(--accent-green); border: 3px solid var(--accent-green); }
        .chain-neuron.skip { background: radial-gradient(circle, #ff446655, #ff446611); color: var(--accent-red); border: 3px solid var(--accent-red); }
        .synapse { width: 80px; height: 8px; background: var(--accent-orange); border-radius: 4px; position: relative; }
        .synapse::after { content: ''; position: absolute; right: -8px; top: -4px; border: 8px solid transparent; border-left-color: var(--accent-orange); }
        .synapse-label { position: absolute; top: -20px; width: 100%; text-align: center; font-size: 0.75rem; color: var(--text-secondary); }

        footer { text-align: center; padding: 20px; color: var(--text-secondary); font-size: 0.85rem; }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Decision Neuron Quest</h1>
            <p class="subtitle">Explore how a single neuron makes decisions</p>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="decide">Decide</button>
            <button class="tab-btn" data-tab="boundary">Boundary</button>
            <button class="tab-btn" data-tab="train">Train</button>
            <button class="tab-btn" data-tab="explore">Explore</button>
            <button class="tab-btn" data-tab="scenarios">Scenarios</button>
        </nav>

        <!-- DECIDE TAB -->
        <div class="tab-panel active" id="decide">
            <div class="main-grid">
                <div class="card">
                    <h3 id="scenarioTitle">Should I Go to the Gym Today?</h3>
                    <div id="inputSliders"></div>
                    <div class="slider-group" style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
                        <div class="slider-header">
                            <span><span class="emoji">üß†</span><span id="biasLabel">Gym Rat Tendency</span></span>
                            <span class="value" id="biasValue">0.20</span>
                        </div>
                        <input type="range" id="biasSlider" min="-3" max="3" step="0.1" value="0.2">
                    </div>
                    <div class="math-display" id="mathDisplay"></div>
                </div>
                <div class="card">
                    <h3>Decision</h3>
                    <div class="neuron-container">
                        <div class="neuron go" id="neuronViz">
                            <span id="neuronProb">75%</span>
                            <span class="label" id="neuronLabel">GO</span>
                        </div>
                        <div class="result-text" id="resultText">Lace up those shoes! üí™</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOUNDARY TAB -->
        <div class="tab-panel" id="boundary">
            <div class="card">
                <h3>Decision Boundary Visualizer</h3>
                <div class="axis-selector">
                    <label>X-Axis: <select id="xAxisSelect"></select></label>
                    <label>Y-Axis: <select id="yAxisSelect"></select></label>
                    <label>Threshold: <input type="range" id="thresholdSlider" min="0" max="100" value="50" style="width:100px;"> <span id="thresholdValue">50%</span></label>
                </div>
                <canvas id="boundaryCanvas"></canvas>
                <p style="margin-top: 12px; font-size: 0.85rem; color: var(--text-secondary);">Gold line = decision boundary. Crosshair = current position.</p>
            </div>
        </div>

        <!-- TRAIN TAB -->
        <div class="tab-panel" id="train">
            <div class="card">
                <h3>Perceptron Training Mode</h3>
                <div class="training-controls">
                    <button class="btn btn-success active" id="labelGoBtn">Label: Went ‚úÖ</button>
                    <button class="btn btn-danger" id="labelSkipBtn">Label: Skipped ‚ùå</button>
                    <button class="btn btn-primary" id="stepBtn">Step</button>
                    <button class="btn btn-primary" id="trainBtn">Train (10x)</button>
                    <button class="btn btn-secondary" id="resetTrainBtn">Reset</button>
                </div>
                <div class="training-stats">
                    <div class="stat-box"><div class="value" id="stepCount">0</div><div class="label">Steps</div></div>
                    <div class="stat-box"><div class="value" id="accuracy">--</div><div class="label">Accuracy</div></div>
                    <div class="stat-box"><div class="value" id="pointCount">0</div><div class="label">Points</div></div>
                    <div class="stat-box"><div class="value">0.1</div><div class="label">Learn Rate</div></div>
                </div>
                <div class="axis-selector">
                    <label>X-Axis: <select id="trainXAxis"></select></label>
                    <label>Y-Axis: <select id="trainYAxis"></select></label>
                </div>
                <canvas id="trainingCanvas"></canvas>
                <div style="margin-top: 12px;">
                    <strong>Presets:</strong>
                    <button class="btn btn-secondary" id="presetBalanced">Balanced</button>
                    <button class="btn btn-secondary" id="presetEnergy">Energy-Based</button>
                    <button class="btn btn-secondary" id="presetGuilty">Lazy but Guilty</button>
                </div>
            </div>
        </div>

        <!-- EXPLORE TAB -->
        <div class="tab-panel" id="explore">
            <div class="main-grid">
                <div class="card">
                    <h3>Activation Function Showdown</h3>
                    <div class="activation-selector">
                        <button class="activation-btn active" data-activation="sigmoid"><div class="name">Sigmoid</div><div class="formula">1/(1+e^-z)</div></button>
                        <button class="activation-btn" data-activation="step"><div class="name">Step</div><div class="formula">z‚â•0?1:0</div></button>
                        <button class="activation-btn" data-activation="relu"><div class="name">ReLU</div><div class="formula">max(0,z)</div></button>
                    </div>
                    <canvas id="activationChart"></canvas>
                    <p style="margin-top:8px;font-size:0.8rem;color:var(--text-secondary);">Current z = <span id="currentZ">0.00</span></p>
                </div>
                <div class="card">
                    <h3>Sensitivity Analysis</h3>
                    <canvas id="sensitivityChart"></canvas>
                    <p style="margin-top:8px;font-size:0.8rem;color:var(--text-secondary);">Each line shows output as that input sweeps 0‚Üí1</p>
                </div>
            </div>
            <div class="card">
                <h3>Two-Neuron Chain</h3>
                <label style="display:flex;align-items:center;gap:8px;margin-bottom:16px;cursor:pointer;">
                    <input type="checkbox" id="showChain"> Show second neuron (Social factors)
                </label>
                <div id="chainSection" style="display:none;">
                    <div class="chain-container">
                        <div class="chain-neuron go" id="neuron1"><span id="n1Prob">75%</span><span class="label">Physical</span></div>
                        <div class="synapse"><span class="synapse-label">w=<span id="chainWeightVal">1.0</span></span></div>
                        <div class="chain-neuron go" id="neuron2"><span id="n2Prob">82%</span><span class="label">Final</span></div>
                    </div>
                    <div style="max-width:400px;margin:0 auto;">
                        <div class="slider-group"><div class="slider-header"><span>Chain Weight</span><span class="value" id="chainWVal">1.0</span></div><input type="range" id="chainWeight" min="-2" max="2" step="0.1" value="1"></div>
                        <div class="slider-group positive"><div class="slider-header"><span>üí∞ Budget</span><span class="value" id="budgetVal">0.50</span></div><input type="range" id="budgetSlider" min="0" max="1" step="0.05" value="0.5"></div>
                        <div class="slider-group positive"><div class="slider-header"><span>üë´ Partner</span><span class="value" id="partnerVal">0.50</span></div><input type="range" id="partnerSlider" min="0" max="1" step="0.05" value="0.5"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCENARIOS TAB -->
        <div class="tab-panel" id="scenarios">
            <div class="card">
                <h3>Choose a Scenario</h3>
                <div class="scenario-grid" id="scenarioGrid"></div>
            </div>
        </div>

        <footer><p>Decision Neuron Quest - Understanding Neural Network Fundamentals</p></footer>
    </div>

    <script>
        // Scenarios
        const scenarios = {
            gym: { title: "Should I Go to the Gym Today?", emoji: "üèãÔ∏è", inputs: [
                { name: "Energy Level", emoji: "‚ö°", weight: 0.8, default: 0.5, positive: true },
                { name: "Guilt Factor", emoji: "üò¨", weight: 0.6, default: 0.3, positive: true },
                { name: "Schedule Freedom", emoji: "üìÖ", weight: 0.5, default: 0.5, positive: true },
                { name: "Soreness", emoji: "üí™", weight: -0.7, default: 0.2, positive: false },
                { name: "Weather/Commute", emoji: "üåßÔ∏è", weight: -0.3, default: 0.3, positive: false }
            ], biasName: "Gym Rat Tendency", biasDefault: 0.2, yesText: "Lace up those shoes! üí™", noText: "Rest day it is üò¥" },
            college: { title: "Choose This College?", emoji: "üéì", inputs: [
                { name: "Reputation", emoji: "‚≠ê", weight: 0.7, default: 0.6, positive: true },
                { name: "Cost", emoji: "üí∏", weight: -0.8, default: 0.5, positive: false },
                { name: "Distance", emoji: "üìç", weight: -0.3, default: 0.4, positive: false },
                { name: "Social Scene", emoji: "üéâ", weight: 0.4, default: 0.5, positive: true },
                { name: "Program Fit", emoji: "üìö", weight: 0.9, default: 0.7, positive: true }
            ], biasName: "Adventure Spirit", biasDefault: 0, yesText: "This is the one! üéì", noText: "Keep looking... üîç" },
            pet: { title: "Adopt a Pet?", emoji: "üêï", inputs: [
                { name: "Free Time", emoji: "‚è∞", weight: 0.6, default: 0.5, positive: true },
                { name: "Living Space", emoji: "üè†", weight: 0.5, default: 0.6, positive: true },
                { name: "Budget", emoji: "üí∞", weight: -0.4, default: 0.5, positive: false },
                { name: "Allergies", emoji: "ü§ß", weight: -0.7, default: 0.2, positive: false },
                { name: "Loneliness", emoji: "üíî", weight: 0.8, default: 0.4, positive: true }
            ], biasName: "Animal Lover", biasDefault: 0.3, yesText: "Welcome your new friend! üêæ", noText: "Maybe not right now ü§î" },
            roadtrip: { title: "Take a Road Trip?", emoji: "üöó", inputs: [
                { name: "Budget", emoji: "üíµ", weight: -0.3, default: 0.5, positive: false },
                { name: "Free Days", emoji: "üìÜ", weight: 0.7, default: 0.4, positive: true },
                { name: "Friend Available", emoji: "üë•", weight: 0.8, default: 0.5, positive: true },
                { name: "Car Condition", emoji: "üöô", weight: 0.4, default: 0.7, positive: true },
                { name: "Distance", emoji: "üõ£Ô∏è", weight: -0.5, default: 0.3, positive: false }
            ], biasName: "Wanderlust", biasDefault: 0.1, yesText: "Hit the road! üõ£Ô∏è", noText: "Stay home this time üè†" },
            tech: { title: "Upgrade Your Tech?", emoji: "üíª", inputs: [
                { name: "Performance Gain", emoji: "üöÄ", weight: 0.7, default: 0.6, positive: true },
                { name: "Price", emoji: "üí∏", weight: -0.9, default: 0.5, positive: false },
                { name: "Device Age", emoji: "üìÖ", weight: 0.5, default: 0.4, positive: true },
                { name: "Reviews", emoji: "‚≠ê", weight: 0.4, default: 0.7, positive: true },
                { name: "Impulse", emoji: "üòà", weight: 0.3, default: 0.3, positive: true }
            ], biasName: "Tech Enthusiast", biasDefault: 0.2, yesText: "Treat yourself! üíª", noText: "Your current device is fine üëç" }
        };

        let currentScenario = 'gym';
        let inputs = [], weights = [], bias = 0.2;
        let activationFn = 'sigmoid';
        let trainingPoints = [], trainStepCount = 0, currentLabel = 1;

        // Activation functions
        const sigmoid = z => 1 / (1 + Math.exp(-z));
        const step = z => z >= 0 ? 1 : 0;
        const relu = z => Math.max(0, z);
        const activate = z => activationFn === 'sigmoid' ? sigmoid(z) : activationFn === 'step' ? step(z) : Math.min(1, relu(z) / 3);

        const computeZ = () => weights.reduce((sum, w, i) => sum + w * inputs[i], bias);
        const computeOutput = (inp = inputs, w = weights, b = bias) => activate(w.reduce((sum, wt, i) => sum + wt * inp[i], b));

        function loadScenario(key) {
            currentScenario = key;
            const s = scenarios[key];
            inputs = s.inputs.map(i => i.default);
            weights = s.inputs.map(i => i.weight);
            bias = s.biasDefault;

            document.getElementById('scenarioTitle').textContent = s.title;
            document.getElementById('biasLabel').textContent = s.biasName;
            document.getElementById('biasSlider').value = bias;
            document.getElementById('biasValue').textContent = bias.toFixed(2);

            document.getElementById('inputSliders').innerHTML = s.inputs.map((inp, i) => `
                <div class="slider-group ${inp.positive ? 'positive' : 'negative'}">
                    <div class="slider-header">
                        <span><span class="emoji">${inp.emoji}</span>${inp.name} <small style="color:var(--text-secondary)">(w=${inp.weight.toFixed(1)})</small></span>
                        <span class="value" id="input${i}Val">${inp.default.toFixed(2)}</span>
                    </div>
                    <input type="range" id="input${i}" min="0" max="1" step="0.01" value="${inp.default}">
                </div>
            `).join('');

            // Attach listeners to new sliders
            s.inputs.forEach((_, i) => {
                document.getElementById(`input${i}`).oninput = function() {
                    inputs[i] = parseFloat(this.value);
                    document.getElementById(`input${i}Val`).textContent = inputs[i].toFixed(2);
                    update();
                };
            });

            populateAxisSelects();
            update();
        }

        function populateAxisSelects() {
            const opts = scenarios[currentScenario].inputs.map((inp, i) => `<option value="${i}">${inp.name}</option>`).join('');
            ['xAxisSelect', 'yAxisSelect', 'trainXAxis', 'trainYAxis'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = opts;
            });
            document.getElementById('xAxisSelect').value = 0;
            document.getElementById('yAxisSelect').value = 3;
            document.getElementById('trainXAxis').value = 0;
            document.getElementById('trainYAxis').value = 3;
        }

        function update() {
            const z = computeZ();
            const output = computeOutput();
            const prob = Math.round(output * 100);
            const isGo = prob >= 50;
            const s = scenarios[currentScenario];

            const neuron = document.getElementById('neuronViz');
            neuron.className = 'neuron ' + (isGo ? 'go' : 'skip') + (prob > 80 ? ' celebration' : '');
            document.getElementById('neuronProb').textContent = prob + '%';
            document.getElementById('neuronLabel').textContent = isGo ? 'GO' : 'SKIP';
            document.getElementById('resultText').textContent = `${prob}% ‚Äî ${isGo ? s.yesText : s.noText}`;

            const mathParts = weights.map((w, i) => `<span class="highlight">${w.toFixed(1)}</span>√ó${inputs[i].toFixed(2)}`).join(' + ');
            document.getElementById('mathDisplay').innerHTML = `
                <div class="equation">z = ${mathParts} + <span class="highlight">${bias.toFixed(2)}</span></div>
                <div class="equation">z = <span class="highlight">${z.toFixed(3)}</span> ‚Üí œÉ(z) = <span class="highlight">${output.toFixed(3)}</span> = ${prob}%</div>
            `;
            document.getElementById('currentZ').textContent = z.toFixed(2);

            drawBoundary();
            drawActivationChart();
            drawSensitivity();
            drawTraining();
            updateChain();
        }

        function drawBoundary() {
            const canvas = document.getElementById('boundaryCanvas');
            if (!canvas.offsetParent) return; // Not visible
            const ctx = canvas.getContext('2d');
            const w = canvas.offsetWidth, h = canvas.offsetHeight;
            canvas.width = w; canvas.height = h;

            const xIdx = parseInt(document.getElementById('xAxisSelect').value);
            const yIdx = parseInt(document.getElementById('yAxisSelect').value);
            const threshold = parseInt(document.getElementById('thresholdSlider').value) / 100;

            for (let py = 0; py < h; py += 8) {
                for (let px = 0; px < w; px += 8) {
                    const testInputs = [...inputs];
                    testInputs[xIdx] = px / w;
                    testInputs[yIdx] = 1 - py / h;
                    const out = computeOutput(testInputs);
                    const t = out;
                    ctx.fillStyle = t < 0.5 ? `rgb(${50+t*200},${50+t*100},${150})` : `rgb(${50},${100+t*155},${50+t*50})`;
                    ctx.fillRect(px, py, 8, 8);
                }
            }

            // Crosshair
            const cx = inputs[xIdx] * w, cy = (1 - inputs[yIdx]) * h;
            ctx.strokeStyle = '#ffd700'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(cx-15,cy); ctx.lineTo(cx+15,cy); ctx.moveTo(cx,cy-15); ctx.lineTo(cx,cy+15); ctx.stroke();
            ctx.beginPath(); ctx.arc(cx, cy, 8, 0, Math.PI*2); ctx.fillStyle = '#ffd700'; ctx.fill();
        }

        function drawTraining() {
            const canvas = document.getElementById('trainingCanvas');
            if (!canvas.offsetParent) return;
            const ctx = canvas.getContext('2d');
            const w = canvas.offsetWidth, h = canvas.offsetHeight;
            canvas.width = w; canvas.height = h;

            const xIdx = parseInt(document.getElementById('trainXAxis').value);
            const yIdx = parseInt(document.getElementById('trainYAxis').value);

            for (let py = 0; py < h; py += 10) {
                for (let px = 0; px < w; px += 10) {
                    const testInputs = [...inputs];
                    testInputs[xIdx] = px / w;
                    testInputs[yIdx] = 1 - py / h;
                    const out = computeOutput(testInputs);
                    ctx.fillStyle = out < 0.5 ? `rgba(255,68,102,${0.3+out*0.4})` : `rgba(0,255,136,${0.3+(1-out)*0.4})`;
                    ctx.fillRect(px, py, 10, 10);
                }
            }

            trainingPoints.forEach(pt => {
                ctx.beginPath();
                ctx.arc(pt.x * w, (1 - pt.y) * h, 10, 0, Math.PI * 2);
                ctx.fillStyle = pt.label === 1 ? '#00ff88' : '#ff4466';
                ctx.fill();
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();
            });
        }

        function drawActivationChart() {
            const canvas = document.getElementById('activationChart');
            if (!canvas.offsetParent) return;
            const ctx = canvas.getContext('2d');
            const w = canvas.offsetWidth, h = canvas.offsetHeight;
            canvas.width = w; canvas.height = h;
            const pad = 40;

            ctx.fillStyle = '#1f2940'; ctx.fillRect(0, 0, w, h);
            ctx.strokeStyle = '#444'; ctx.lineWidth = 1;
            ctx.beginPath(); ctx.moveTo(pad, h-pad); ctx.lineTo(w-pad, h-pad); ctx.moveTo(pad, pad); ctx.lineTo(pad, h-pad); ctx.stroke();

            const fns = { sigmoid: ['#00d4ff', sigmoid], step: ['#ff8c00', step], relu: ['#00ff88', z => Math.min(1, relu(z)/3)] };
            Object.entries(fns).forEach(([name, [color, fn]]) => {
                ctx.strokeStyle = name === activationFn ? color : color + '44';
                ctx.lineWidth = name === activationFn ? 3 : 1;
                ctx.beginPath();
                for (let px = 0; px <= w - 2*pad; px++) {
                    const z = (px / (w - 2*pad)) * 10 - 5;
                    const y = fn(z);
                    const py = (1 - y) * (h - 2*pad) + pad;
                    px === 0 ? ctx.moveTo(pad + px, py) : ctx.lineTo(pad + px, py);
                }
                ctx.stroke();
            });

            const currentZ = computeZ();
            const zx = ((currentZ + 5) / 10) * (w - 2*pad) + pad;
            const zy = (1 - activate(currentZ)) * (h - 2*pad) + pad;
            ctx.beginPath(); ctx.arc(Math.max(pad, Math.min(w-pad, zx)), Math.max(pad, Math.min(h-pad, zy)), 8, 0, Math.PI*2);
            ctx.fillStyle = '#ffd700'; ctx.fill();
        }

        function drawSensitivity() {
            const canvas = document.getElementById('sensitivityChart');
            if (!canvas.offsetParent) return;
            const ctx = canvas.getContext('2d');
            const w = canvas.offsetWidth, h = canvas.offsetHeight;
            canvas.width = w; canvas.height = h;
            const pad = 50;

            ctx.fillStyle = '#1f2940'; ctx.fillRect(0, 0, w, h);
            ctx.strokeStyle = '#444'; ctx.lineWidth = 1;
            ctx.beginPath(); ctx.moveTo(pad, h-pad); ctx.lineTo(w-pad, h-pad); ctx.moveTo(pad, pad); ctx.lineTo(pad, h-pad); ctx.stroke();

            const colors = ['#00d4ff', '#00ff88', '#ffd700', '#ff4466', '#ff8c00'];
            const s = scenarios[currentScenario];
            s.inputs.forEach((inp, idx) => {
                ctx.strokeStyle = colors[idx % colors.length]; ctx.lineWidth = 2;
                ctx.beginPath();
                for (let px = 0; px <= w - 2*pad; px++) {
                    const xVal = px / (w - 2*pad);
                    const testInputs = [...inputs];
                    testInputs[idx] = xVal;
                    const out = computeOutput(testInputs);
                    const py = (1 - out) * (h - 2*pad) + pad;
                    px === 0 ? ctx.moveTo(pad + px, py) : ctx.lineTo(pad + px, py);
                }
                ctx.stroke();

                // Legend
                ctx.fillStyle = colors[idx % colors.length];
                ctx.fillRect(w - 110, pad + idx * 16, 10, 10);
                ctx.fillStyle = '#aaa'; ctx.font = '10px sans-serif';
                ctx.fillText(inp.name.substring(0, 10), w - 95, pad + idx * 16 + 9);
            });
        }

        function updateChain() {
            if (!document.getElementById('showChain').checked) return;
            const chainW = parseFloat(document.getElementById('chainWeight').value);
            const budget = parseFloat(document.getElementById('budgetSlider').value);
            const partner = parseFloat(document.getElementById('partnerSlider').value);

            document.getElementById('chainWVal').textContent = chainW.toFixed(1);
            document.getElementById('chainWeightVal').textContent = chainW.toFixed(1);
            document.getElementById('budgetVal').textContent = budget.toFixed(2);
            document.getElementById('partnerVal').textContent = partner.toFixed(2);

            const a1 = computeOutput();
            const z2 = chainW * a1 + 0.5 * budget + 0.6 * partner;
            const a2 = sigmoid(z2);

            document.getElementById('n1Prob').textContent = Math.round(a1 * 100) + '%';
            document.getElementById('n2Prob').textContent = Math.round(a2 * 100) + '%';
            document.getElementById('neuron1').className = 'chain-neuron ' + (a1 >= 0.5 ? 'go' : 'skip');
            document.getElementById('neuron2').className = 'chain-neuron ' + (a2 >= 0.5 ? 'go' : 'skip');
        }

        function trainStep() {
            if (trainingPoints.length === 0) return;
            const lr = 0.1;
            const xIdx = parseInt(document.getElementById('trainXAxis').value);
            const yIdx = parseInt(document.getElementById('trainYAxis').value);
            const pt = trainingPoints[Math.floor(Math.random() * trainingPoints.length)];
            const testInputs = [...inputs];
            testInputs[xIdx] = pt.x;
            testInputs[yIdx] = pt.y;
            const output = computeOutput(testInputs);
            const error = pt.label - output;
            weights[xIdx] += lr * error * pt.x;
            weights[yIdx] += lr * error * pt.y;
            bias += lr * error;
            trainStepCount++;
            document.getElementById('stepCount').textContent = trainStepCount;

            let correct = 0;
            trainingPoints.forEach(p => {
                const ti = [...inputs]; ti[xIdx] = p.x; ti[yIdx] = p.y;
                if ((computeOutput(ti) >= 0.5 ? 1 : 0) === p.label) correct++;
            });
            document.getElementById('accuracy').textContent = Math.round(correct / trainingPoints.length * 100) + '%';
            update();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadScenario('gym');

            // Tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.onclick = function() {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(this.dataset.tab).classList.add('active');
                    setTimeout(update, 50);
                };
            });

            // Bias slider
            document.getElementById('biasSlider').oninput = function() {
                bias = parseFloat(this.value);
                document.getElementById('biasValue').textContent = bias.toFixed(2);
                update();
            };

            // Threshold
            document.getElementById('thresholdSlider').oninput = function() {
                document.getElementById('thresholdValue').textContent = this.value + '%';
                drawBoundary();
            };

            // Axis selects
            ['xAxisSelect', 'yAxisSelect'].forEach(id => {
                document.getElementById(id).onchange = drawBoundary;
            });
            ['trainXAxis', 'trainYAxis'].forEach(id => {
                document.getElementById(id).onchange = drawTraining;
            });

            // Training
            document.getElementById('labelGoBtn').onclick = function() {
                currentLabel = 1;
                document.getElementById('labelGoBtn').classList.add('active');
                document.getElementById('labelSkipBtn').classList.remove('active');
            };
            document.getElementById('labelSkipBtn').onclick = function() {
                currentLabel = 0;
                document.getElementById('labelSkipBtn').classList.add('active');
                document.getElementById('labelGoBtn').classList.remove('active');
            };
            document.getElementById('trainingCanvas').onclick = function(e) {
                const rect = this.getBoundingClientRect();
                trainingPoints.push({ x: (e.clientX - rect.left) / rect.width, y: 1 - (e.clientY - rect.top) / rect.height, label: currentLabel });
                document.getElementById('pointCount').textContent = trainingPoints.length;
                drawTraining();
            };
            document.getElementById('stepBtn').onclick = trainStep;
            document.getElementById('trainBtn').onclick = function() { for (let i = 0; i < 10; i++) setTimeout(trainStep, i * 100); };
            document.getElementById('resetTrainBtn').onclick = function() {
                trainingPoints = []; trainStepCount = 0;
                weights = scenarios[currentScenario].inputs.map(i => i.weight);
                bias = scenarios[currentScenario].biasDefault;
                document.getElementById('stepCount').textContent = '0';
                document.getElementById('pointCount').textContent = '0';
                document.getElementById('accuracy').textContent = '--';
                update();
            };

            // Presets
            document.getElementById('presetBalanced').onclick = function() {
                trainingPoints = [];
                for (let i = 0; i < 10; i++) {
                    trainingPoints.push({ x: 0.2 + Math.random() * 0.3, y: 0.5 + Math.random() * 0.4, label: 0 });
                    trainingPoints.push({ x: 0.5 + Math.random() * 0.4, y: 0.1 + Math.random() * 0.4, label: 1 });
                }
                document.getElementById('pointCount').textContent = trainingPoints.length;
                drawTraining();
            };
            document.getElementById('presetEnergy').onclick = function() {
                trainingPoints = [];
                for (let i = 0; i < 10; i++) {
                    trainingPoints.push({ x: Math.random() * 0.4, y: Math.random(), label: 0 });
                    trainingPoints.push({ x: 0.6 + Math.random() * 0.4, y: Math.random(), label: 1 });
                }
                document.getElementById('pointCount').textContent = trainingPoints.length;
                drawTraining();
            };
            document.getElementById('presetGuilty').onclick = function() {
                trainingPoints = [];
                for (let i = 0; i < 8; i++) {
                    trainingPoints.push({ x: 0.2 + Math.random() * 0.3, y: 0.7 + Math.random() * 0.25, label: 1 });
                    trainingPoints.push({ x: 0.4 + Math.random() * 0.4, y: Math.random() * 0.4, label: 0 });
                }
                document.getElementById('pointCount').textContent = trainingPoints.length;
                drawTraining();
            };

            // Activation buttons
            document.querySelectorAll('.activation-btn').forEach(btn => {
                btn.onclick = function() {
                    document.querySelectorAll('.activation-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    activationFn = this.dataset.activation;
                    update();
                };
            });

            // Chain
            document.getElementById('showChain').onchange = function() {
                document.getElementById('chainSection').style.display = this.checked ? 'block' : 'none';
                updateChain();
            };
            ['chainWeight', 'budgetSlider', 'partnerSlider'].forEach(id => {
                document.getElementById(id).oninput = updateChain;
            });

            // Scenarios
            const grid = document.getElementById('scenarioGrid');
            grid.innerHTML = Object.entries(scenarios).map(([key, s]) => `
                <button class="scenario-btn ${key === 'gym' ? 'active' : ''}" data-scenario="${key}">
                    <span class="emoji">${s.emoji}</span>
                    <span class="name">${s.title.split('?')[0]}?</span>
                </button>
            `).join('');
            grid.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.onclick = function() {
                    grid.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    loadScenario(this.dataset.scenario);
                };
            });

            update();
        });
    </script>
</body>
</html>
